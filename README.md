<h1 align="center">
  <br>
  <img src="https://github.com/user-attachments/assets/fc4eee91-ae47-4e53-92c6-81c0c6a6c57b" alt="Wedy logo" width="200" />
  <p>
  Wedy
  <p>
</h1>
<h4 align="center">ì˜ˆë¹„ ì‹ ë‘ ì‹ ë¶€ë¥¼ ìœ„í•œ ì¼ì • ê´€ë¦¬ & ì»¤í”Œ í”Œë˜ë„ˆ</h4>

## ğŸ“˜ í”„ë¡œì íŠ¸ ê°œìš”

> ì»¤í”Œì´ í•¨ê»˜ ì¼ì •ê³¼ íƒœìŠ¤í¬ë¥¼ ê´€ë¦¬í•˜ê³ , ê²°í˜¼ ì¤€ë¹„ ê³¼ì •ì„ ê³µìœ í•  ìˆ˜ ìˆëŠ” **í”Œë˜ë„ˆ ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤.

**ê°œë°œ ê¸°ê°„**: 2025.6.15 ~ 2025.07.30 (6ì£¼, í”„ë¡œí† íƒ€ì… ë‹¨ê³„ ì¢…ë£Œ)

**í•µì‹¬ êµ¬í˜„**: ì»¤í”Œ ë§¤ì¹­ / ì¼ì • ë“±ë¡ / ToDo ê´€ë¦¬

# í”„ë¡œì íŠ¸ ì´ë¯¸ì§€

<br>

<img width="" height="515" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-09-12 á„‹á…©á„Œá…¥á†« 7 52 49" src="https://github.com/user-attachments/assets/9048e991-6694-4680-bfd7-5c0e1690b1c2" />


<img width="" height="256" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-09-12 á„‹á…©á„Œá…¥á†« 7 54 25" src="https://github.com/user-attachments/assets/b4863a0c-11d5-4cf0-bebe-99d273073f9c" />

<img width="" height="344" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-09-12 á„‹á…©á„Œá…¥á†« 7 55 30" src="https://github.com/user-attachments/assets/94896167-a98e-47ef-8f4b-b73ca6ce79a4" />



<img width="" height="364" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-09-12 á„‹á…©á„Œá…¥á†« 7 56 35" src="https://github.com/user-attachments/assets/8322c723-e1e2-4d3d-b9f6-b9a5be9d6801" />




<img width="" height="292" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-09-12 á„‹á…©á„Œá…¥á†« 7 58 27" src="https://github.com/user-attachments/assets/5a0e7c49-a73c-4baf-9830-a48b81ce835b" />

# íŒ€ì›

| <img src="https://github.com/user-attachments/assets/984d3041-b787-4da3-b07e-f2132411193e" width="150"> | <img src="https://github.com/user-attachments/assets/caf98b12-21c5-4396-80b5-d3054a36d33b" width="150"> |
|:-------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------:|
|                               [HyungGeun](https://github.com/HyungGeun94)                               |                                  [JeHyuck](https://github.com/jehyuck)                                  |
|                                                   BE                                                    |                                                   BE                                                    |

## âš™ï¸ ì•„í‚¤í…ì²˜ ë° ë„ë©”ì¸ ì„¤ê³„

### ğŸ§© Main Domain Flow

           Couple ---- CoupleTask ---- Task
             ã…£             ã…£
             ã…£             ã…£
            User         SubTask

- **Couple**: ë‘ ëª…ì˜ Userë¥¼ ì—°ê²°í•˜ëŠ” í•µì‹¬ ì—”í‹°í‹°
    - ì´ˆëŒ€ ì½”ë“œ(inviteCode)ë¡œ ìƒì„± ë° ë§¤ì¹­
    - ì»¤í”Œ ë‹¨ìœ„ë¡œ Taskì™€ SubTaskê°€ ê´€ë¦¬ë¨

- **User**: ê°œì¸ ê³„ì •ìœ¼ë¡œ, í•˜ë‚˜ì˜ Coupleì— ì†í•¨
    - SubTaskì˜ ë‹´ë‹¹ìë¡œ ì°¸ì—¬ ê°€ëŠ¥

- **CoupleTask**: ì»¤í”Œì´ í•¨ê»˜ ê´€ë¦¬í•˜ëŠ” ì¼ì • ë‹¨ìœ„
    - Coupleì— ì†í•˜ë©° ì—¬ëŸ¬ SubTaskë¥¼ ê°€ì§
    - ì»¤í”Œì˜ ì‹¤ì œ í˜‘ì—… ë‹¨ìœ„

- **SubTask**: ì„¸ë¶€ ì—…ë¬´ ë‹¨ìœ„
    - íŠ¹ì • CoupleTaskì— ì¢…ì†
    - íŠ¹ì • Userê°€ ë‹´ë‹¹ ê°€ëŠ¥

- **Task (ì˜µì…˜)**: ë°˜ë³µ ìƒì„±ë˜ëŠ” íƒœìŠ¤í¬ì˜ í…œí”Œë¦¿/ê¸°ì¤€ ëª¨ë¸

## ğŸ§± ì½”ë“œ êµ¬ì¡° ì˜ˆì‹œ

### ğŸ’¡ Service - ì—”í‹°í‹° ë° ë¦¬í¬ì§€í† ë¦¬ í˜¸ì¶œ ë° ì¡°í•© ì—­í• 

```java

@Transactional
public void updateWeddingDate(Long userId, LocalDate newWeddingDate) {
    User user = userRepository.findByUserWithCoupleAndPartner(userId)
        .orElseThrow(InvalidUserAccessException::new);

    if (!user.isMatched()) {
        throw new NotMatchedYetException();
    }

    Couple couple = user.getCouple();
    couple.updateWeddingDate(newWeddingDate);
}
```

```java

@Transactional
public void softDeleteCoupleTasks(List<Long> taskIds, Long coupleId) {
    List<CoupleTask> coupleTasksToDelete = coupleTaskRepository.findByTaskIdsAndCoupleId(
        taskIds, coupleId);

    if (coupleTasksToDelete.size() != taskIds.size()) {
        throw new RuntimeException("Some tasks not found or permission denied.");
    }

    coupleTasksToDelete.forEach(CoupleTask::updateDeleteStatus);
}
```

### ğŸ’¡ Repository - ìˆœìˆ˜ ì¿¼ë¦¬ ì±…ì„

```java

@OneToMany(mappedBy = "coupleTask", cascade = CascadeType.ALL, orphanRemoval = true)
@BatchSize(size = 100) // 1:N ìµœì í™”
private List<SubTask> subTasks;
```

```java

@Query("select ct from CoupleTask ct " +
    "join fetch ct.task t " +
    "where ct.couple.id = :coupleId and ct.deleted = false")
List<CoupleTask> findByCoupleIdWithTask(@Param("coupleId") Long coupleId);

@Query("SELECT ct FROM CoupleTask ct "
    + "WHERE ct.task.id IN :taskIds AND "
    + "ct.couple.id = :coupleId AND "
    + "ct.deleted = false")
List<CoupleTask> findByTaskIdsAndCoupleId(@Param("taskIds") List<Long> taskIds,
    @Param("coupleId") Long coupleId);
```

```java

@Override
public Optional<User> findUserWithCoupleAndConfigById(Long userId) {
    User result = queryFactory
        .selectFrom(user)
        .join(user.userConfig, userConfig).fetchJoin()
        .join(user.couple, couple).fetchJoin()
        .where(user.id.eq(userId))
        .fetchOne();

    return Optional.ofNullable(result);
}
```

### ğŸ’¡ Domain - ë„ë©”ì¸ ê°ì²´ëŠ” ìŠ¤ìŠ¤ë¡œ ìƒíƒœë¥¼ ë³€ê²½í•˜ê³  ê´€ë¦¬ (ìƒì„±, ì¡°íšŒ, ì—°ê´€ê´€ê³„, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)

ìƒì„± ë©”ì„œë“œ

```java
// private ìƒì„±ì (ë¹Œë” íŒ¨í„´ìš©)
@Builder(access = AccessLevel.PRIVATE)
private CoupleTask(Couple couple, Task task) {
    this.couple = couple;
    this.task = task;
    this.subTasks = new ArrayList<>();
    this.deleted = false;
}

// ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ
public static CoupleTask create(Task task, Couple couple) {
    return CoupleTask.builder()
        .task(task)
        .couple(couple)
        .build();
}
```

ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ

```java
    // ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ
public void matchCouple(Couple couple) {
    this.couple = couple;
    if (couple != null) {
        couple.getUsers().add(this);
    }
}
```

ë‹¨ìˆœ ì¡°íšŒ ë° ë³€ê²½ ë©”ì„œë“œ

```java
    public void updateMemo(String memo) {
    if (memo != null && memo.length() > 18) {
        throw new IllegalArgumentException("ë©”ëª¨ëŠ” 18ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
    this.memo = memo;
}
```

ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ

```java
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ
public void initializeTasks(List<Task> tasks) {
    if (!coupleTasks.isEmpty()) {
        throw new IllegalStateException("Tasks already initialized for this couple");
    }

    tasks.forEach(task -> {
        CoupleTask coupleTask = CoupleTask.create(task, this);

        // ê¸°ë³¸ SubTask ìƒì„± ì±…ì„ì„ CoupleTaskë¡œ ìœ„ì„
        coupleTask.initializeDefaultSubTasks();

        addCoupleTask(coupleTask);
    });
}
```

<br>
<hr>

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

| êµ¬ë¶„          | ëª©ì              | ê¸°ìˆ  ìŠ¤íƒ                   |
|-------------|----------------|-------------------------|
| Controller  | API ì‘ë‹µ ê²€ì¦      | @WebMvcTest + MockMvc   |
| Service     | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | MockitoExtension        |
| Repository  | ì¿¼ë¦¬ ê²€ì¦          | @DataJpaTest + QueryDSL |
| Domain      | ì—”í‹°í‹° ìƒíƒœ ì „ì´ ê²€ì¦   | JUnit5 + AssertJ        |
| Integration | ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸    | @SpringBootTest         |

> í…ŒìŠ¤íŠ¸ì— ìµìˆ™í•´ì§€ëŠ”ê²ƒê³¼ ì˜³ì€ ë°©ì‹ì— ì§‘ì¤‘

### ğŸ§© ëŒ€í‘œ í…ŒìŠ¤íŠ¸ ì½”ë“œ

Domain Unit Test

```java

@Test
@DisplayName("ë‘ ëª…ì˜ Userê°€ ë™ì¼í•œ Coupleì— ë§¤ì¹­ë˜ì–´ì•¼ í•œë‹¤.")
void shouldMatchTwoUsersToSameCouple() {
    // Given
    User groom = User.create("groom_oauth", "kakao");
    User bride = User.create("bride_oauth", "naver");
    Couple couple = Couple.create();

    // When
    groom.matchCouple(couple);
    bride.matchCouple(couple);

    // Then
    assertThat(groom.getCouple()).isEqualTo(couple);
    assertThat(bride.getCouple()).isEqualTo(couple);
    assertThat(couple.getUsers())
        .containsExactlyInAnyOrder(groom, bride)
        .hasSize(2);
}
```

Integration Test

```java

@Test
@DisplayName("ë©”ëª¨ ìˆ˜ì • í†µí•© í…ŒìŠ¤íŠ¸ ì„±ê³µ")
void updateMemo_integration_success() throws Exception {
    // given
    String newMemo = "ìƒˆë¡œìš´ ë©”ëª¨ì…ë‹ˆë‹¤.";
    MemoRequestDto requestDto = new MemoRequestDto(newMemo);
    String requestBody = objectMapper.writeValueAsString(requestDto);

    // when
    mockMvc.perform(patch("/api/user/memo")
            .header("Authorization", "Bearer " + accessToken)
            .contentType(MediaType.APPLICATION_JSON)
            .content(requestBody))
        .andDo(print())
        .andExpect(status().isOk())
        .andExpect(jsonPath("$.code").value(200));

    // then
    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ DBì— ê°•ì œ ë°˜ì˜í•˜ê³ , ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ì›Œ DBì—ì„œ ìƒˆë¡œ ì¡°íšŒí•˜ë„ë¡ í•¨
    entityManager.flush();
    entityManager.clear();

    User updatedUser = userRepository.findById(testUser.getId()).orElseThrow();
    assertEquals(newMemo, updatedUser.getMemo());
}
```

Controller Slice Test

```java

@Test
@DisplayName("ë©”ëª¨ ìˆ˜ì • ì„±ê³µ")
void updateMemo_success() throws Exception {
    // given
    Long loginUserId = 1L;
    String newMemoContent = "ìƒˆë¡œìš´ ë©”ëª¨ ë‚´ìš©";
    MemoRequestDto requestDto = new MemoRequestDto(newMemoContent);

    doNothing().when(userService).updateMemo(anyLong(), any(MemoRequestDto.class));

    // when & then
    mockMvc.perform(patch("/api/user/memo")
            .with(csrf())
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(requestDto)))
        .andDo(print())
        .andExpect(status().isOk())
        .andExpect(jsonPath("$.code").value(200));

    // verify
    verify(userService).updateMemo(anyLong(), any(MemoRequestDto.class));
}
```

Repository Slice Test

```java

@Test
@DisplayName("Couple ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•´ì•¼ í•œë‹¤.")
void couple_Association_WorksCorrectly() {
    // Given
    // Couple ì—”í‹°í‹° ìƒì„± ë° ì €ì¥
    Couple newCouple = Couple.create();
    Couple savedCouple = coupleRepository.save(newCouple);

    // User ì—”í‹°í‹° ìƒì„± ë° Couple í• ë‹¹
    User newUser = User.create("test-oauth-couple", "kakao");
    newUser.updateNickname("ì»¤í”Œ"); // 2ì ë‹‰ë„¤ì„ìœ¼ë¡œ ìˆ˜ì •
    newUser.matchCouple(savedCouple);

    // When
    // User ì €ì¥
    User savedUser = userRepository.save(newUser);

    // Userë¥¼ ë‹¤ì‹œ ì¡°íšŒ (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” í›„)
    Optional<User> foundUserOptional = userRepository.findById(savedUser.getId());

    // Then
    assertThat(foundUserOptional).isPresent();
    User foundUser = foundUserOptional.get();

    // Couple ì—°ê´€ê´€ê³„ê°€ ì˜¬ë°”ë¥´ê²Œ ë¡œë“œë˜ì—ˆëŠ”ì§€ ê²€ì¦
    assertThat(foundUser.getCouple()).isNotNull();
    assertThat(foundUser.getCouple().getId()).isEqualTo(savedCouple.getId());
}

@Test
@DisplayName("Unique ì œì•½ì¡°ê±´: ì¤‘ë³µëœ oauthIdë¡œ ì €ì¥ ì‹œë„ ì‹œ ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.")
void oauthId_ShouldBeUnique() {
    // Given
    User user1 = User.create("same-oauth-id", "kakao");
    User user2 = User.create("same-oauth-id", "naver");

    // ì²« ë²ˆì§¸ ìœ ì €ëŠ” ì •ìƒì ìœ¼ë¡œ ì €ì¥
    userRepository.saveAndFlush(user1);

    // When & Then (ì‹¤í–‰ ë° ê²€ì¦)
    // ë‘ ë²ˆì§¸ ìœ ì €ë¥¼ ì €ì¥í•˜ë ¤ê³  í•  ë•Œ, DBì˜ unique ì œì•½ì¡°ê±´ ìœ„ë°˜ìœ¼ë¡œ ì˜ˆì™¸ê°€ ë°œìƒ ê²€ì¦ ( unique ì œì•½ì¡°ê±´ )
    assertThatThrownBy(() -> {
        userRepository.saveAndFlush(user2);
    }).isInstanceOf(DataIntegrityViolationException.class);
}

```

Service Unit Test

```java

@Test
@DisplayName("saveOrGetUser: ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ë©´ ê¸°ì¡´ ì‚¬ìš©ìë¥¼ ë°˜í™˜í•˜ê³  ì €ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.")
void saveOrGetUser_UserExists_ReturnsExistingUserAndDoesNotSave() {
    // Given
    String oauthId = "existing-oauth-id";
    String provider = "google";
    String profileImageUrl = "http://existing.profile.image/url.jpg";

    User existingUser = User.create(oauthId, provider);
    existingUser.updateProfileImage(profileImageUrl);

    // Mocking: userRepository.findByOauthId(oauthId)ê°€ ê¸°ì¡´ User ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •
    when(userRepository.findByOauthId(oauthId)).thenReturn(Optional.of(existingUser));

    // When
    User resultUser = userService.saveOrGetUser(oauthId, provider, profileImageUrl);

    // Then
    assertThat(resultUser).isNotNull();
    assertThat(resultUser.getOauthId()).isEqualTo(oauthId);
    assertThat(resultUser.getProvider()).isEqualTo(provider);
    assertThat(resultUser.getProfileImageUrl()).isEqualTo(profileImageUrl);
    verify(userRepository, times(1)).findByOauthId(oauthId); // findByOauthIdê°€ 1ë²ˆ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦
    verify(userRepository, never()).save(any(User.class)); // saveê°€ í˜¸ì¶œë˜ì§€ ì•Šì•˜ëŠ”ì§€ ê²€ì¦
}
```

# ê¸°ìˆ  ìŠ¤íƒ

	â€¢ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ë° í”„ë ˆì„ì›Œí¬
      Java 17, SpringBoot

	â€¢ ë°ì´í„°ë² ì´ìŠ¤ 
      mysql 8.0

	â€¢ ë„ì»¤ ë° ì»¨í…Œì´ë„ˆí™”
      Docker, Docker Compose

    â€¢ ì¸í”„ë¼ ë° í´ë¼ìš°ë“œ ê´€ë ¨ ì„œë¹„ìŠ¤
      aws ec2, route53, ELB, ECR, IAM, S3

    â€¢ DevOps ë° CI/CD ê´€ë ¨ ë„êµ¬
       github actions, postman, swagger

    â€¢ í˜‘ì—… ë° ê°œë°œ ë„êµ¬ 
       github, notion, discord, intelliJ

# ì£¼ìš” ê¸°ëŠ¥

```
íšŒì›ê°€ì… ë° ì»¤í”Œì½”ë“œ ë§¤ì¹­
```

```
í•¨ê»˜ í•  íƒœìŠ¤í¬ ë“±ë¡ ë° ì¡°íšŒ
```

[//]: # (# ì£¼ìš” ê¸°ëŠ¥ ì¼ë¶€ ìƒì„¸ ì½”ë“œ)

[//]: # ()

[//]: # (&#40; ì‘ì„± ì˜ˆì • &#41;)

# ğŸ’­íšŒê³  - í˜•ê·¼ (í›„ê¸°)

ì»¤í”Œ ë§¤ì¹­ ë¡œì§ ë° í•  ì¼ ëª©ë¡ ì¡°íšŒë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
<br>
ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„ë¥¼ ì ìš©í•˜ë©° í…ŒìŠ¤íŠ¸ ì½”ë“œ ì ìš©ì„ í•´ë´¤ê³ , ì¢€ ë” ì¿¼ë¦¬ì™€ ê°ì²´ì— ëŒ€í•´ ì•Œê²Œ ë˜ëŠ” í”„ë¡œì íŠ¸ì˜€ìŠµë‹ˆë‹¤.
<br>
<br>
ë¹„ë¡ í”„ë¡œí† íƒ€ì… ë‹¨ê³„ì—ì„œ ë§ˆë¬´ë¦¬ë˜ì—ˆì§€ë§Œ, ì¶”í›„ í™•ì¥ì„ ê³ ë ¤í•œ ê¸°ë°˜ ì„¤ê³„ë¥¼ ëª©í‘œë¡œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.


<p align="center"><i>Â© 2025 Team Wedy</i></p>

